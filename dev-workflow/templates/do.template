#!/usr/bin/env bash
set -euo pipefail

# ============================================================
# ./do — Development task runner
#
# This script is the single entry point for all development
# tasks. It is self-contained: it checks for prerequisites,
# auto-installs dependencies where possible, and "just works"
# when run from a fresh checkout.
#
# Philosophy:
#   - One-stop shop: ./do run starts everything
#   - Self-contained: auto-installs what it can
#   - Minimal host dependencies: only requires bash and basic tools
#   - Running documentation: the script IS the setup guide
#
# Usage: ./do <command>
#
# Commands:
#   build    Build the project
#   lint     Run linter
#   test     Run tests
#   run      Run the project locally
#   check    Full verification (must pass before every commit)
# ============================================================

# --- Color output helpers ---

_green()  { printf '\033[0;32m%s\033[0m\n' "$*"; }
_yellow() { printf '\033[0;33m%s\033[0m\n' "$*"; }
_red()    { printf '\033[0;31m%s\033[0m\n' "$*"; }
_bold()   { printf '\033[1m%s\033[0m\n' "$*"; }

# --- Dependency checks ---

require_cmd() {
  if ! command -v "$1" &>/dev/null; then
    _red "Required command not found: $1"
    if [ -n "${2:-}" ]; then
      _yellow "Install it: $2"
    fi
    exit 1
  fi
}

# --- Commands ---

build() {
  _bold "build"
  _yellow "Not implemented yet — ./do build will be configured by /dev:plan"
}

lint() {
  _bold "lint"
  _yellow "Not implemented yet — ./do lint will be configured by /dev:plan"
}

test_cmd() {
  _bold "test"
  _yellow "Not implemented yet — ./do test will be configured by /dev:plan"
}

run_cmd() {
  _bold "run"
  _yellow "Not implemented yet — ./do run will be configured by /dev:plan"
}

check() {
  _bold "check"
  _yellow "Not implemented yet — ./do check will be configured by /dev:plan"
}

case "${1:-}" in
  build)  build ;;
  lint)   lint ;;
  test)   test_cmd ;;
  run)    run_cmd ;;
  check)  check ;;
  *)
    _bold "Usage: ./do <command>"
    echo ""
    echo "Commands:"
    echo "  build    Build the project"
    echo "  lint     Run linter"
    echo "  test     Run tests"
    echo "  run      Run the project locally"
    echo "  check    Full verification (must pass before every commit)"
    exit 1
    ;;
esac
